##################################################
# FILAMENT RUNOUT – SIMPLE & RELIABLE VERSION
# 3-short → 2-long repeating pattern (~10 minutes)
##################################################
[gcode_macro FILAMENT_RUNOUT]
description: Pause and sound a long-running alarm on filament runout
gcode:
    RESPOND TYPE=echo MSG="Filament runout detected! Insert filament and press RESUME."
    M117 Filament Runout Detected

    # Optional: only needed if your beeper requires pin enable
    # Remove if your beeper works without this
    SET_PIN PIN=BEEPER_pin VALUE=1

    # ---- 10-minute repeated beep pattern ----
    # (one block ~6 sec, repeated ~100 times)

{% for i in range(100) %}
    M300 S1000 P150
    M300 S1000 P150
    M300 S1000 P150
    G4 P600

    M300 S1500 P150
    M300 S1500 P150
    G4 P5000
{% endfor %}

    # Turn off beeper after pattern completes (failsafe)
    SET_PIN PIN=BEEPER_pin VALUE=0